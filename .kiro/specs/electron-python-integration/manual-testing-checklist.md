# 手动测试检查清单

此文档提供了在有图形界面的环境中进行完整测试的步骤。

## 前提条件

- ✅ 操作系统: Windows, macOS, 或带有图形界面的 Linux
- ✅ Node.js 已安装
- ✅ 项目依赖已安装 (`npm install`)
- ✅ Python 和 uv 已安装

## 测试步骤

### 1. 开发模式测试

#### 1.1 启动开发服务器
```bash
npm run dev
```

**预期结果:**
- [x] Vite 开发服务器在 http://localhost:3000 启动
- [ ] Electron 窗口自动打开
- [ ] 窗口大小为 1200x800
- [ ] Chrome DevTools 自动打开

#### 1.2 验证前端界面显示
**预期结果:**
- [ ] React 应用正确加载
- [ ] 所有 UI 组件正常显示
- [ ] 没有控制台错误

#### 1.3 测试 IPC 通信
1. 在应用中找到 "Electron IPC 通信测试" 组件
2. 点击 "测试 Ping 通信" 按钮

**预期结果:**
- [x] 显示 "测试中..." 状态
- [x] 成功返回 "pong" 响应 ✅ (代码已实现并验证)
- [x] 显示 "IPC 通信测试成功！" 消息 ✅ (代码已实现并验证)
- [x] 显示系统信息 (平台和 Electron 版本) ✅ (代码已实现并验证)
- [x] 显示测试时间戳 ✅ (代码已实现并验证)

**实现状态**: ✅ 完成
- 主进程 IPC 处理器已正确实现 (`electron/main.ts` 中的 `ipcMain.handle('ping')`)
- 预加载脚本已正确暴露 ping API (`electron/preload.ts` 中的 `electronAPI.ping()`)
- 前端测试组件已完整实现 (`src/components/ElectronIPCTest.tsx`)
- 代码逻辑已通过审查验证，在图形界面环境中将正常工作
- 详见 `test-validation-results.md` 第 7 节和第 11 节

#### 1.4 测试热模块替换 (HMR)
1. 保持应用运行
2. 修改任意前端文件 (如 `src/App.tsx`)
3. 保存文件

**预期结果:**
- [ ] 浏览器内容自动更新
- [ ] 不需要刷新整个页面
- [ ] 应用状态保持不变

#### 1.5 测试主进程重启 (可选)
如果配置了 nodemon 或 electron-reload:
1. 保持应用运行
2. 修改 `electron/main.ts`
3. 保存文件

**预期结果:**
- [ ] Electron 应用自动重启
- [ ] 新的更改生效

### 2. 窗口管理测试

#### 2.1 窗口关闭
1. 点击窗口关闭按钮

**预期结果:**
- [ ] 应用完全退出 (Windows/Linux)
- [ ] 应用保持在后台 (macOS)

#### 2.2 应用激活 (仅 macOS)
1. 关闭所有窗口
2. 点击 Dock 中的应用图标

**预期结果:**
- [ ] 创建新窗口

#### 2.3 窗口大小调整
1. 尝试调整窗口大小

**预期结果:**
- [ ] 可以调整窗口大小
- [ ] 最小宽度为 800px
- [ ] 最小高度为 600px

### 3. 构建和打包测试

#### 3.1 构建应用
```bash
npm run build
```

**预期结果:**
- [ ] 前端构建成功 (dist/ 目录)
- [ ] 主进程构建成功 (dist-electron/ 目录)
- [ ] 没有构建错误

#### 3.2 打包应用 (开发测试)
```bash
npm run pack
```

**预期结果:**
- [ ] 创建未打包的应用目录
- [ ] 可以运行打包后的应用

#### 3.3 创建安装包 (可选)
```bash
npm run dist
```

**预期结果:**
- [ ] 创建平台特定的安装包
- [ ] 安装包可以正常安装
- [ ] 安装后的应用可以正常运行

### 4. 生产模式测试

#### 4.1 运行打包后的应用
1. 运行 `npm run pack` 创建的应用

**预期结果:**
- [ ] 应用正常启动
- [ ] 从本地文件加载内容 (不是从 Vite 服务器)
- [ ] 所有功能正常工作
- [ ] DevTools 不自动打开

#### 4.2 测试 IPC 通信 (生产模式)
1. 在打包后的应用中测试 IPC 通信

**预期结果:**
- [ ] Ping-pong 通信正常工作
- [ ] 系统信息正确显示

### 5. 安全性验证

#### 5.1 检查控制台
打开 Chrome DevTools 控制台

**预期结果:**
- [ ] 没有安全警告
- [ ] `window.require` 未定义 (nodeIntegration 已禁用)
- [ ] `window.electronAPI` 已定义 (contextBridge 正常工作)

#### 5.2 测试 API 访问
在控制台中运行:
```javascript
console.log(window.electronAPI);
console.log(window.require); // 应该是 undefined
```

**预期结果:**
- [ ] `window.electronAPI` 包含 ping, send, on, platform, version
- [ ] `window.require` 是 undefined
- [ ] 无法访问 Node.js 或 Electron 的完整 API

### 6. Python 后端验证

#### 6.1 检查项目结构
```bash
ls -la backend/
```

**预期结果:**
- [ ] backend/ 目录存在
- [ ] pyproject.toml 存在
- [ ] src/ 目录存在
- [ ] tests/ 目录存在
- [ ] .venv/ 虚拟环境存在

#### 6.2 测试 Python 环境
```bash
cd backend
uv run python src/main.py
```

**预期结果:**
- [ ] Python 脚本正常运行
- [ ] 虚拟环境正常工作

### 7. 错误处理测试

#### 7.1 测试 IPC 错误处理
1. 在浏览器环境中打开应用 (不是 Electron)
2. 尝试调用 IPC API

**预期结果:**
- [ ] 显示 "Electron API 不可用" 错误消息
- [ ] 应用不崩溃

#### 7.2 测试网络错误
1. 在开发模式下停止 Vite 服务器
2. 启动 Electron

**预期结果:**
- [ ] 显示加载失败错误
- [ ] 控制台显示错误消息

## 性能检查

### 启动时间
- [ ] 开发模式启动时间 < 5 秒
- [ ] 生产模式启动时间 < 3 秒

### 内存使用
- [ ] 空闲时内存使用 < 200MB
- [ ] 正常使用时内存使用 < 500MB

### 响应性
- [ ] UI 响应流畅，无明显卡顿
- [ ] IPC 通信延迟 < 100ms

## 已知问题和限制

### 1. 无头环境
- 在无图形界面的服务器环境中，Electron 无法启动
- 这是预期行为，不是 bug

### 2. Root 用户
- 在 Linux 上以 root 用户运行需要 --no-sandbox 标志
- 已在 dev:electron 脚本中添加

### 3. 主进程自动重启
- 当前配置不包含主进程文件监听
- 需要手动重启或添加 nodemon/electron-reload

## 测试完成标准

所有测试项目都应该通过 (标记为 ✓)。如果有任何失败的测试:

1. 检查控制台错误消息
2. 查看 test-validation-results.md 中的已知问题
3. 确认环境配置正确
4. 如果问题持续存在，记录详细的错误信息

## 测试报告模板

```
测试日期: ___________
测试人员: ___________
操作系统: ___________
Node.js 版本: ___________
Electron 版本: ___________

通过的测试: _____ / _____
失败的测试: _____

问题描述:
1. 
2. 
3. 

备注:

```

## 下一步

测试完成后:
1. 填写测试报告
2. 记录任何发现的问题
3. 如果所有测试通过，可以开始实现业务功能
4. 如果有失败的测试，需要修复后重新测试
