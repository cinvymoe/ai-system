# 手动测试清单 - 摄像头数据库集成

## 测试环境准备

### 前置条件
- [ ] 后端服务已启动 (`cd backend && uvicorn src.main:app --reload`)
- [ ] 前端应用已启动 (`npm run dev`)
- [ ] 数据库文件存在 (`backend/data/vision_security.db`)
- [ ] 浏览器开发者工具已打开（用于查看网络请求和控制台日志）

### 测试数据准备
- [ ] 备份现有数据库（如果存在）
- [ ] 准备测试用的摄像头配置数据

---

## 1. 数据库初始化测试

### 测试目标
验证数据库在首次启动时正确初始化

### 测试步骤
1. [ ] 删除现有数据库文件（如果存在）：`rm backend/data/vision_security.db`
2. [ ] 启动后端服务
3. [ ] 检查数据库文件是否创建：`ls -la backend/data/vision_security.db`
4. [ ] 验证表结构：`sqlite3 backend/data/vision_security.db ".schema cameras"`

### 预期结果
- ✅ 数据库文件自动创建
- ✅ cameras 表结构正确（包含所有必需字段）
- ✅ 索引已创建（direction, status）
- ✅ 无错误日志

### 实际结果
- [ ] 通过 / [ ] 失败
- 备注：

---

## 2. 摄像头 CRUD 操作测试

### 2.1 创建摄像头（Create）

#### 测试场景 A：创建有效摄像头
**步骤：**
1. [ ] 打开摄像头设置页面
2. [ ] 点击"添加摄像头"按钮
3. [ ] 填写表单：
   - 名称：`测试摄像头1`
   - URL：`rtsp://192.168.1.100:554/stream`
   - 方向：`forward`
   - 分辨率：`1920x1080`
   - FPS：`30`
   - 亮度：`50`
   - 对比度：`50`
4. [ ] 点击"保存"按钮

**预期结果：**
- ✅ 显示成功提示消息
- ✅ 摄像头出现在列表中
- ✅ 数据库中有新记录
- ✅ 所有字段值正确保存

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

#### 测试场景 B：创建重复名称摄像头
**步骤：**
1. [ ] 尝试创建名称为`测试摄像头1`的摄像头（已存在）

**预期结果：**
- ✅ 显示错误提示："Camera name already exists"
- ✅ 摄像头未被创建
- ✅ 数据库记录数不变

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

#### 测试场景 C：创建无效数据摄像头
**步骤：**
1. [ ] 尝试创建空名称摄像头
2. [ ] 尝试创建无效 URL 格式（如 `http://test`）
3. [ ] 尝试创建亮度值为 150（超出范围）
4. [ ] 尝试创建对比度值为 -10（超出范围）

**预期结果：**
- ✅ 每个场景都显示相应的验证错误
- ✅ 摄像头未被创建
- ✅ 错误消息清晰明确

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 2.2 读取摄像头（Read）

#### 测试场景 A：获取所有摄像头
**步骤：**
1. [ ] 打开摄像头列表页面
2. [ ] 观察列表加载

**预期结果：**
- ✅ 显示加载状态
- ✅ 所有摄像头正确显示
- ✅ 按方向分组显示
- ✅ 加载时间 < 2秒

**实际结果：**
- [ ] 通过 / [ ] 失败
- 加载时间：_____ 秒
- 备注：

#### 测试场景 B：按方向获取摄像头
**步骤：**
1. [ ] 创建不同方向的摄像头（forward, backward, left, right, idle）
2. [ ] 验证每个方向组显示正确的摄像头

**预期结果：**
- ✅ 每个方向组只显示对应方向的摄像头
- ✅ 摄像头数量统计正确

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 2.3 更新摄像头（Update）

#### 测试场景 A：更新摄像头配置
**步骤：**
1. [ ] 选择一个摄像头
2. [ ] 点击"编辑"按钮
3. [ ] 修改名称为`测试摄像头1-已修改`
4. [ ] 修改亮度为`70`
5. [ ] 点击"保存"

**预期结果：**
- ✅ 显示成功提示
- ✅ 列表中立即显示更新后的数据
- ✅ 数据库中数据已更新
- ✅ `updated_at` 时间戳已更新

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

#### 测试场景 B：更新为重复名称
**步骤：**
1. [ ] 创建两个摄像头：`摄像头A` 和 `摄像头B`
2. [ ] 尝试将`摄像头B`的名称改为`摄像头A`

**预期结果：**
- ✅ 显示错误提示："Camera name already exists"
- ✅ 更新被拒绝
- ✅ 原数据保持不变

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

#### 测试场景 C：更新失败回滚
**步骤：**
1. [ ] 编辑摄像头
2. [ ] 输入无效数据（如亮度 200）
3. [ ] 尝试保存

**预期结果：**
- ✅ 显示验证错误
- ✅ 数据库中数据未改变
- ✅ UI 显示原始数据

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 2.4 删除摄像头（Delete）

#### 测试场景 A：删除存在的摄像头
**步骤：**
1. [ ] 选择一个摄像头
2. [ ] 点击"删除"按钮
3. [ ] 确认删除

**预期结果：**
- ✅ 显示确认对话框
- ✅ 摄像头从列表中移除
- ✅ 数据库中记录已删除
- ✅ 显示成功提示

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

#### 测试场景 B：删除不存在的摄像头
**步骤：**
1. [ ] 使用 API 直接尝试删除不存在的 ID

**预期结果：**
- ✅ 返回 404 错误
- ✅ 错误消息："Camera not found"

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

---

## 3. 数据验证测试

### 3.1 必填字段验证
**步骤：**
1. [ ] 尝试创建缺少名称的摄像头
2. [ ] 尝试创建缺少 URL 的摄像头
3. [ ] 尝试创建缺少方向的摄像头

**预期结果：**
- ✅ 每个场景都显示"字段必填"错误
- ✅ 表单不允许提交

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 3.2 URL 格式验证
**步骤：**
1. [ ] 输入 `http://test.com` （非 rtsp）
2. [ ] 输入 `invalid-url`
3. [ ] 输入 `rtsp://192.168.1.100:554/stream` （有效）

**预期结果：**
- ✅ 前两个显示"无效的 URL 格式"错误
- ✅ 第三个通过验证

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 3.3 数值范围验证
**步骤：**
1. [ ] 输入亮度 `-10`
2. [ ] 输入亮度 `150`
3. [ ] 输入亮度 `50` （有效）
4. [ ] 输入 FPS `0`
5. [ ] 输入 FPS `100`
6. [ ] 输入 FPS `30` （有效）

**预期结果：**
- ✅ 超出范围的值显示错误
- ✅ 有效值通过验证

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 3.4 分辨率格式验证
**步骤：**
1. [ ] 输入 `1920x1080` （有效）
2. [ ] 输入 `1920*1080` （无效）
3. [ ] 输入 `invalid` （无效）

**预期结果：**
- ✅ 有效格式通过
- ✅ 无效格式显示错误

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

---

## 4. 状态切换测试

### 4.1 启用/禁用切换
**步骤：**
1. [ ] 创建一个启用的摄像头
2. [ ] 点击启用开关，禁用摄像头
3. [ ] 观察 UI 变化
4. [ ] 再次点击开关，重新启用

**预期结果：**
- ✅ 开关立即响应
- ✅ UI 状态立即更新
- ✅ 数据库中 `enabled` 字段已更新
- ✅ 切换动画流畅

**实际结果：**
- [ ] 通过 / [ ] 失败
- 响应时间：_____ 毫秒
- 备注：

### 4.2 状态更新
**步骤：**
1. [ ] 创建一个摄像头（默认 status: offline）
2. [ ] 使用 API 更新状态为 online
3. [ ] 观察 UI 更新

**预期结果：**
- ✅ UI 在 1 秒内反映新状态
- ✅ 状态指示器颜色改变
- ✅ 数据库中 status 字段已更新

**实际结果：**
- [ ] 通过 / [ ] 失败
- 更新延迟：_____ 毫秒
- 备注：

### 4.3 批量状态切换
**步骤：**
1. [ ] 创建 5 个摄像头
2. [ ] 快速切换所有摄像头的启用状态

**预期结果：**
- ✅ 所有操作都成功
- ✅ 没有状态不一致
- ✅ UI 正确反映所有变化

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

---

## 5. 数据持久化测试

### 5.1 基本持久化
**步骤：**
1. [ ] 创建 3 个摄像头
2. [ ] 记录它们的配置
3. [ ] 关闭应用
4. [ ] 重新启动应用
5. [ ] 验证摄像头数据

**预期结果：**
- ✅ 所有摄像头仍然存在
- ✅ 所有配置数据正确
- ✅ 启用状态保持
- ✅ 时间戳保持

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 5.2 更新后持久化
**步骤：**
1. [ ] 修改一个摄像头的配置
2. [ ] 重启应用
3. [ ] 验证修改已保存

**预期结果：**
- ✅ 修改的数据已保存
- ✅ `updated_at` 时间戳正确

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 5.3 删除后持久化
**步骤：**
1. [ ] 删除一个摄像头
2. [ ] 重启应用
3. [ ] 验证摄像头不存在

**预期结果：**
- ✅ 删除的摄像头不再出现
- ✅ 其他摄像头不受影响

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

---

## 6. 错误处理测试

### 6.1 后端服务不可用
**步骤：**
1. [ ] 停止后端服务
2. [ ] 尝试加载摄像头列表
3. [ ] 尝试创建摄像头

**预期结果：**
- ✅ 显示友好的错误消息
- ✅ 提供重试选项
- ✅ 应用不崩溃

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 6.2 网络延迟模拟
**步骤：**
1. [ ] 使用浏览器开发工具模拟慢速网络
2. [ ] 执行各种操作

**预期结果：**
- ✅ 显示加载状态指示器
- ✅ 操作最终完成
- ✅ 超时后显示错误（5秒）

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 6.3 数据库锁定
**步骤：**
1. [ ] 使用 SQLite 工具锁定数据库
2. [ ] 尝试写入操作

**预期结果：**
- ✅ 显示数据库忙碌错误
- ✅ 提供重试机制

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 6.4 无效响应处理
**步骤：**
1. [ ] 修改后端返回无效 JSON
2. [ ] 观察前端处理

**预期结果：**
- ✅ 捕获解析错误
- ✅ 显示友好错误消息
- ✅ 应用保持稳定

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

---

## 7. UI 交互测试

### 7.1 按钮响应
**步骤：**
1. [ ] 点击所有主要按钮（添加、编辑、删除、保存、取消）
2. [ ] 验证每个按钮的响应

**预期结果：**
- ✅ 按钮点击有视觉反馈
- ✅ 禁用状态正确显示
- ✅ 加载状态显示 spinner

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 7.2 表单验证提示
**步骤：**
1. [ ] 在表单中输入无效数据
2. [ ] 观察验证提示

**预期结果：**
- ✅ 实时验证反馈
- ✅ 错误消息清晰
- ✅ 错误消息位置合理

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 7.3 列表操作
**步骤：**
1. [ ] 滚动摄像头列表
2. [ ] 搜索/筛选摄像头（如果有）
3. [ ] 排序摄像头（如果有）

**预期结果：**
- ✅ 滚动流畅
- ✅ 筛选立即生效
- ✅ 排序正确

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 7.4 加载和错误状态
**步骤：**
1. [ ] 触发加载状态
2. [ ] 触发错误状态
3. [ ] 观察 UI 显示

**预期结果：**
- ✅ 加载 spinner 显示
- ✅ 错误消息清晰
- ✅ 可以从错误状态恢复

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

---

## 8. 方向分组测试

### 8.1 分组显示
**步骤：**
1. [ ] 创建以下摄像头：
   - 2 个 forward
   - 2 个 backward
   - 1 个 left
   - 1 个 right
   - 1 个 idle
2. [ ] 观察列表分组

**预期结果：**
- ✅ 按方向正确分组
- ✅ 每组显示正确数量
- ✅ 组标题清晰

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 8.2 跨组操作
**步骤：**
1. [ ] 将一个摄像头从 forward 改为 backward
2. [ ] 观察 UI 更新

**预期结果：**
- ✅ 摄像头移动到新组
- ✅ 两个组的计数更新
- ✅ 动画流畅

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

---

## 9. 并发操作测试

### 9.1 快速连续操作
**步骤：**
1. [ ] 快速连续添加 5 个摄像头
2. [ ] 验证所有操作成功

**预期结果：**
- ✅ 所有摄像头都创建成功
- ✅ 没有重复或丢失
- ✅ 数据一致

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 9.2 同时编辑和删除
**步骤：**
1. [ ] 打开编辑对话框
2. [ ] 在另一个窗口删除同一摄像头
3. [ ] 尝试保存编辑

**预期结果：**
- ✅ 显示"摄像头不存在"错误
- ✅ 列表正确更新
- ✅ 没有数据损坏

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

---

## 10. 边界条件测试

### 10.1 空数据库
**步骤：**
1. [ ] 清空数据库
2. [ ] 打开应用

**预期结果：**
- ✅ 显示空状态提示
- ✅ 提供"添加第一个摄像头"引导
- ✅ 没有错误

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 10.2 大量数据
**步骤：**
1. [ ] 创建 50+ 个摄像头
2. [ ] 测试列表性能
3. [ ] 测试搜索/筛选性能

**预期结果：**
- ✅ 列表加载时间 < 3秒
- ✅ 滚动流畅（60fps）
- ✅ 操作响应及时

**实际结果：**
- [ ] 通过 / [ ] 失败
- 摄像头数量：_____
- 加载时间：_____ 秒
- 备注：

### 10.3 特殊字符
**步骤：**
1. [ ] 创建名称包含特殊字符的摄像头：
   - `摄像头 #1`
   - `Camera (Test)`
   - `测试-摄像头_2024`
   - `Caméra Spéciale`

**预期结果：**
- ✅ 所有字符正确保存
- ✅ 所有字符正确显示
- ✅ 搜索功能正常

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

### 10.4 极长字符串
**步骤：**
1. [ ] 尝试创建 200 字符的名称
2. [ ] 尝试创建 500 字符的 URL

**预期结果：**
- ✅ 显示长度限制错误
- ✅ 或正确截断并保存

**实际结果：**
- [ ] 通过 / [ ] 失败
- 备注：

---

## 测试总结

### 测试统计
- 总测试场景数：_____ 个
- 通过：_____ 个
- 失败：_____ 个
- 跳过：_____ 个
- 通过率：_____ %

### 发现的问题

#### 高优先级问题
1. 

#### 中优先级问题
1. 

#### 低优先级问题
1. 

### 性能指标
- 平均加载时间：_____ 秒
- 平均操作响应时间：_____ 毫秒
- 大数据集性能（50+ 摄像头）：_____

### 建议和改进
1. 

### 测试人员
- 姓名：_____
- 日期：_____
- 测试环境：_____
  - 操作系统：_____
  - 浏览器：_____
  - Python 版本：_____
  - Node 版本：_____

### 签名
测试完成并确认：_______________
