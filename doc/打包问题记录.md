# Electron 应用打包问题记录

## 1. 包名不支持中文

**问题**: electron-builder 不支持 package.json 中的中文包名
```
Error: Invalid name: "视觉安全监控系统界面"
```

**解决方法**: 将 package.json 中的 name 改为英文
```json
"name": "vision-security-monitor"
```

## 2. 缺少必要的元数据

**问题**: 构建 deb 包时缺少必要的元数据
```
Please specify project homepage
Please specify author 'email' in the application package.json
```

**解决方法**: 在 package.json 中添加完整的元数据
```json
"description": "Vision Security Monitoring System",
"author": {
  "name": "Vision Security Team",
  "email": "team@vision-security.local"
},
"homepage": "https://github.com/vision-security/monitor"
```

## 3. Electron 下载失败

**问题**: 网络问题导致 Electron 二进制文件下载失败

**解决方法**: 手动下载并放到缓存目录
```bash
# 下载文件后复制到缓存
cp electron-v39.2.3-linux-arm64.zip ~/.cache/electron/
cp electron-v39.2.3-linux-x64.zip ~/.cache/electron/
```

## 4. ARM 设备 GPU 错误

**问题**: 在 ARM 设备上运行时出现 GPU 初始化错误
```
ERROR:viz_main_impl.cc:189] Exiting GPU process due to errors during initialization
```

**解决方法**: 在 Electron 主进程中禁用硬件加速
```typescript
// electron/main.ts
app.disableHardwareAcceleration();
```

## 5. 打包后白屏问题

**问题**: 打包后的应用运行时显示白屏，资源文件无法加载

**原因**: Vite 构建时使用了绝对路径 `/assets/...`，在 Electron 本地文件加载时无法正确解析

**解决方法**: 
1. 在 vite.config.ts 中设置 base 为相对路径
```typescript
base: process.env.ELECTRON === 'true' ? './' : '/'
```

2. 在 package.json 构建脚本中设置环境变量
```json
"build:vite": "cross-env ELECTRON=true vite build"
```

这样构建后的 HTML 会使用相对路径 `./assets/...`

## 6. 打包配置优化

**electron-builder.yml 配置**:
```yaml
linux:
  target:
    - target: tar.gz
      arch:
        - arm64
        - x64
  category: Utility
```

**package.json 脚本**:
```json
"dist:arm64": "npm run build && electron-builder --linux --arm64",
"dist:linux": "npm run build && electron-builder --linux"
```

## 构建产物

成功构建后会生成以下文件：
- `release/vision-security-monitor-0.1.0-arm64.tar.gz` - ARM64 架构
- `release/vision-security-monitor-0.1.0.tar.gz` - x64 架构
- `release/linux-arm64-unpacked/` - ARM64 未打包目录
- `release/linux-unpacked/` - x64 未打包目录
